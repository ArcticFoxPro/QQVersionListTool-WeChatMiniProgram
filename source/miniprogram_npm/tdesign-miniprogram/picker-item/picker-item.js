import{__decorate}from"tslib";import{SuperComponent,wxComponent}from"../common/src/index";import config from"../common/config";import props from"./props";const{prefix:prefix}=config,name=`${prefix}-picker-item`,ANIMATION_DURATION=1e3,INERTIA_TIME=300,INERTIA_DISTANCE=15,range=function(t,e,i){return Math.min(Math.max(t,e),i)},momentum=(t,e)=>{let i=t;return i=Math.abs(i/e)/.005*(i<0?-1:1),i};let PickerItem=class extends SuperComponent{constructor(){super(...arguments),this.relations={"../picker/picker":{type:"parent",linked(t){if("keys"in t.data){const{keys:e}=t.data;this.setData({labelAlias:(null==e?void 0:e.label)||"label",valueAlias:(null==e?void 0:e.value)||"value"})}}}},this.options={multipleSlots:!0},this.externalClasses=[`${prefix}-class`],this.properties=props,this.observers={options(){this.update()}},this.data={prefix:prefix,classPrefix:name,offset:0,duration:0,value:"",curIndex:0,columnIndex:0,labelAlias:"label",valueAlias:"value",formatOptions:props.options.value},this.lifetimes={created(){this.StartY=0,this.StartOffset=0,this.startTime=0}},this.methods={onTouchStart(t){this.StartY=t.touches[0].clientY,this.StartOffset=this.data.offset,this.startTime=Date.now(),this.setData({duration:0})},onTouchMove(t){const{StartY:e,StartOffset:i}=this,{pickItemHeight:s}=this.data,o=t.touches[0].clientY-e,a=range(i+o,-this.getCount()*s,0);this.setData({offset:a})},onTouchEnd(t){const{offset:e,labelAlias:i,valueAlias:s,columnIndex:o,pickItemHeight:a,formatOptions:n}=this.data,{startTime:l}=this;if(e===this.StartOffset)return;let r=0;const d=t.changedTouches[0].clientY-this.StartY,h=Date.now()-l;h<300&&Math.abs(d)>15&&(r=momentum(d,h));const c=range(e+r,-this.getCount()*a,0),u=range(Math.round(-c/a),0,this.getCount()-1);this.setData({offset:-u*a,duration:1e3,curIndex:u}),u!==this._selectedIndex&&(this._selectedIndex=u,wx.nextTick((()=>{var t,e,a;this._selectedIndex=u,this._selectedValue=null===(t=n[u])||void 0===t?void 0:t[s],this._selectedLabel=null===(e=n[u])||void 0===e?void 0:e[i],null===(a=this.$parent)||void 0===a||a.triggerColumnChange({index:u,column:o})})))},formatOption:(t,e,i)=>"function"!=typeof i?t:t.map((t=>i(t,e))),update(){var t,e,i,s;const{options:o,value:a,labelAlias:n,valueAlias:l,pickItemHeight:r,format:d,columnIndex:h}=this.data,c=this.formatOption(o,h,d),u=c.findIndex((t=>t[l]===a)),m=u>0?u:0;this._selectedIndex=m,this._selectedValue=null===(t=c[m])||void 0===t?void 0:t[l],this._selectedLabel=null===(e=c[m])||void 0===e?void 0:e[n],this.setData({formatOptions:c,offset:-m*r,curIndex:m}),this._selectedIndex=m,this._selectedValue=null===(i=o[m])||void 0===i?void 0:i[l],this._selectedLabel=null===(s=o[m])||void 0===s?void 0:s[n]},getCount(){var t,e;return null===(e=null===(t=this.data)||void 0===t?void 0:t.options)||void 0===e?void 0:e.length}}}};PickerItem=__decorate([wxComponent()],PickerItem);export default PickerItem;